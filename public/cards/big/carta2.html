<!DOCTYPE html>
<html>
	<html lang="en">

		<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>MakeCardGames - Card Creation</title>
		
		<!-- Link das fontes ultilizadas de um servidor google -->
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Monoton&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="../config-cards/style-card2.css"/>
		<link rel="stylesheet" href="../config-cards/config-card.css"/>
		</head>
<body>

<!-- Inicio da configuração do menu -->

<header>

	<div class= "center">
		<div class="logo">
			<h3> MCG </h3>
		</div>
		
	<div class= "center">
				<div class="name">
			<h2>Make Card Game - Creation</h2>
		</div> <!-- name -->
		
		</div> <!-- login -->
	</div> <!-- center -->
			
</header>
	
	<div class= "left">	
		<div class="menu">
			<a href="../../home.html">
			<span class="material-icons" id= "btnIcon">account_circle</span>Home
			</a>
			
			<a href="../../game.html">
			<span class="material-icons" id= "btnIcon">sports_esports</span> Games
			</a>
			
			<a href="../../profile.html">
			<span class="material-icons" id= "btnIcon">person</span> Account
			</a>
						
			<ul  class="menu-more">
			<li>
			<a href="#"> <span class="material-icons">expand_more</span> More </a>
				<ul>
					<li><a href="../../forum.html"><span class="material-icons">forum</span> Forum</a></li>
					<li><a href="../../faq.html"><span class="material-icons">quiz</span> FAQ</a></li>
					<li><a href="../../help.html"><span class="material-icons">help</span> Help</a></li>
				</ul>	
			 </li>
			</ul>
			
		</div> <!-- menu -->
				<div class="search">
			<ul class="menu-search">
				<li id="menu-search"> <input id="search" type="text" placeholder="search..."/>
				<li id="menu-search"> <a href="../../search.html"> <span class="material-icons" id="btnSearch" alt="search">search</span> </a>
			</ul>
		</div> <!-- search -->
	</div> <!-- left -->
<!-- Fim da configuração do menu -->
			
		
	<div class="arruma">
			<div class="title">
				<h2>Card Creation Menu</h2>
			</div><!--tittle-->

			<div class="appe">
				<h1>Card Appearence</h1>
			</div><!--appe-->

			<!--Início da configuração das abas-->
			<nav class="nav_tabs">
				<!--Aba 1(Card body)-->
				<ul>
					<li>
						<input type="radio" name="tabs" class="nd_tabs" id="t1">
						<label for="t1" id="la">Card body</label>
					<div class="content">
						<article>
							<table>
								<td>

							<label for="border">Name Border</label>
							  <select id="bd" name="border">
								  <option value=""disabled selected>Select the image for card name border</option>
								<option value="8">Upload from computer</option>								
								<option value="9">Link</option>								
								<option value="10">Use preset</option>
								<option value="11">None</option>
							  </select>							  
								<button id="upload-borderimg-button">
									<span class="material-icons">file_download</span>
								</button>
								<input id="selecao-arquivo-bord" style="display: none;" type='file' onchange="readURL3(this);" />
							  	<input type="text" class="input-text" name="url" id="border-url-carta-input" placeholder=" Image in URL"/>
							  <br>

							  <label for="name">Card Name</label>
							  <input type="text" class="input-text" name="name" id="nome-carta-input" placeholder="Input the Card Name"> 
							  <br>

							  <label id="l" for="url">Card Image</label>
							  <input type="text" class="input-text" name="url" id="imagem-url-carta-input" placeholder=" Image in URL">
							  <input id="selecao-arquivo-img" style="display: none;" type='file' onchange="readURL2(this);"/>
							  </select>
							  <button id="upload-img">
								<span class="material-icons">file_download</span>
							  </button>
							  <br>
						   <label class="border">Border Color</label>
							  <input type="color" class="input-text-color" id="cor-texto-carta-input" placeholder="Cor do Texto">
							  <br>
							  
							  <label class="font">Font Color</label>
							  <input type="color" class="input-text-color-2" id="cor-carta-input" placeholder="Cor da Carta">
						 <br>
							  <label for="back">Backgroud Image</label>
							  <select id="bii" name="back" >
								<option value=""disabled selected>Select a image or color for card background</option>
								<option value="4"> Upload from computer</option>
								<option value="5">Link</option>
								<option value="6">Use preset</option>
								<option value="7" id="texture-card-input">Color</option>
							  </select>
							  <input type="color" class="input-text-color-3" id="cor-fundo-carta-input" hidden="false" placeholder="Cor de Fundo">
							  <button id="upload-backimage-button">
								  <span class="material-icons">file_download</span>
							  </button>
							  
							  <input id="selecao-arquivo" style="display: none" type='file' onchange="readURL(this);" />
							  <input type="text" class="input-text" name="url" id="background-url-carta-input" placeholder=" Image in URL"> 
							  <br>
							  
							  </td>
						  </table>
						</article>
					</div>
					</li><!--fim da aba 1-->

					<!--aba 2(Card atributes)-->
					<li>
						<input type="radio" name="tabs" class="nd_tabs" id="t2">
						<label for="t2" id="la">Card Atributes</label>
						<div class="content">
						<article>
							<table>

						<td>

							<label id="l" for="Eicon">Element Icon</label>
								<select id="ei" name="Eicon">
								  <option value=""disabled selected>Select a image for the element icon</option>
								  <option value="12">Upload from computer</option>
								  <option value="13">Link</option><option value="14">Use preset</option>
								</select>
                                <input type="text" class="input-text-card" name="url" id="icon-url-carta-input" style="display: none;" placeholder=" Image in URL">
								  
								<br>								 

								<label id="l" for="mp">Mana cost</label>
								<input type="number" class="input-text" name="mp" id="custo-mana-carta-input" placeholder="MP">  
								<br>

								<label id="l" for="a1">Ability 1 Name</label>
								<textarea class="input-text" name="a1" id="atributos-carta-input" style="vertical-align: middle;" placeholder="Atributes of Card"></textarea>
								<br>

								<label id="l1" for="d1">Ability 1 Description</label>
								<textarea class="input-text" name="d1" id="descricao-carta-input" style="vertical-align: middle;" placeholder="Description of Card"></textarea>
								<br>

								<label id="l" for="a2">Ability 2 Name</label>
								<textarea class="input-text" name="a2" id="atributos-carta-input2" style="vertical-align: middle;"placeholder="Atributes of Card 2"></textarea>
								<br>

								<label id="l2" for="d2">Ability 2 Description</label>
								<textarea class="input-text" name="d2" id="descricao-carta-input2" style="vertical-align: middle;" placeholder="Description of Card 2"></textarea>
								<br>			
							</td>
                                <button id="upload-iconimg-button" class="upload-iconimg-button">
                                    <span class="material-icons">file_download</span>
                                </button>
                                <input id="selecao-arquivo-icon" type='file' onchange="readURL4(this);" hidden/>
							    
							</table>
						</article>
					</div>
					</li>
				</ul><!--Fim da aba 2-->
			</nav>
				<!--Fim da configuração das abas-->
				
			<select id="bar" name="baralho">
				<option value="" disabled selected>Select the deck you want to put the card</option>
				<option value="24" id="24">Deck 1</option>
				<option value="25">New Deck</option>
			</select>
			

			<div class="config-carta">
				<div class="center-div carta-container">
					<div class="arumation">
					<div class="carta textura-cor" id="carta">
						
						<div class="topo-carta">
							<div class="nome-carta" id="nome-carta">
								<h4 id="top-name-config">Card Name</h4>
							</div>
                                <img id="top-name-config-img" src="//cdn.shopify.com/s/files/1/2910/3910/products/tnt-rosa_x700.jpg?v=1539197232"/>
							    <img id="icon-img" src="https://static.vecteezy.com/system/resources/previews/001/190/575/non_2x/flower-icon-png.png"/>
							<div class="custo-mana" id="custo-mana-carta">
								3
							</div>
						</div>
						
						<input type="color" class="input-text" id="cor-fundo-carta-input" hidden="true" placeholder="Cor de Fundo">
						<div class="gradiente-container" hidden="true" id="gradiente-container">
							<input type="color" class="gradient-picker" id="gradient-picker"/><input type="color" class="gradient-picker" id="gradient-picker"/><button class="add gradient-button" href="#">Add Color</button>  
							<button id="reset-gradient-button" class="gradient-button" style="display: none;">Reset</button>
							<button id="gradient-button" class="gradient-button">Gradient This</button>
						</div>
						
						<div class="imagem-carta" id="imagem-carta-container">
							<img id="img-carta" src="https://i.pinimg.com/originals/5b/0b/33/5b0b33ca30a6f5ad68b3f5b2ed08c977.jpg" alt=""> <!---->
						</div>
						<div class="rodape-carta">
							<div class="config-descricao-carta">
								<div class="atributos-carta" id="atributos-carta">
									Ability 1 Name
								</div>
								<div class="descricao-carta" id="descricao-carta" >
									Description Card
								</div>
								<div class="atributos-carta" id="atributos-carta2">
									Ability 2 Name
								</div>
								<div class="descricao-carta2" id="descricao-carta2">
									Description Card
								</div>
							</div>
						</div>
						<img id="background-carta" src="https://i.pinimg.com/originals/b5/bb/87/b5bb87a208d6ef3510fbfa8dd2177e73.jpg"  alt=""> <!---->
					</div>

					</div>
				</div>

				<p id="mat-01">Card Saved!</p>
				<button id="button">Send For Deck</button>
				<button id="button-03">Download Card</button>
			</div>
			
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
<script src="../../cards/config-cards/javascript/script-card1.js"></script>
<script type="module" type="text/javascript">
            import { initializeApp, getApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
			import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, updateProfile } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';
			import { getFirestore, collection, doc, query, where, arrayUnion, setDoc, getDoc, updateDoc, getDocs } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
			import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js';
			
            const firebaseApp = initializeApp({
			apiKey: "AIzaSyAR61dkpsiGFCQRzCQ4nkAbU0plC-kYslY",
			authDomain: "make-cardgame.firebaseapp.com",
			projectId: "make-cardgame",
			storageBucket: "make-cardgame.appspot.com",
			messagingSenderId: "1016341861949",
			appId: "1:1016341861949:web:c95383455399adf6597c54",
			measurementId: "G-RBP9Q9N1ES"
			});
			const auth = getAuth();
			const html= "carta2";
					
			onAuthStateChanged(auth, (user) => {

				//card nummb
				const db = getFirestore(firebaseApp);
				const list = doc(db, user.uid, "card");
				const lisut = doc(db, user.uid, "deck");

				const docSupu = getDoc(lisut)
					.then(docSupu => {

					const arry = docSupu.data().deckName;

					arry.forEach(arry => {
						const docSunapu = getDoc(list)
					.then(docSunapu => {
						const array = docSunapu.data().Cards;

							array.forEach(array => {
							const card = doc(db, user.uid, "deck", arry, array);
							console.log(card);
							const docSnapuu = getDoc(card)
								.then(docSnapuu => {
								
								console.log(array);			
							if(docSnapuu.data().click == true){
								const storage = getStorage(firebaseApp);
								

							
							getDownloadURL(ref(storage, "deck-pic/"+`${user.uid}`+`/card/${array}/bord-img`))
							.then((url) => {
								// `url` is the download URL for 'images/stars.jpg'

								// This can be downloaded directly:
								const xhr = new XMLHttpRequest();
								xhr.responseType = 'blob';
								xhr.onload = (event) => {
								const blob = xhr.response;
								};
								xhr.open('GET', url);
								xhr.send();

								// Or inserted into an <img> element
								const img = document.getElementById('top-name-config-img');
								img.setAttribute('src', url);
							})
							.catch((error) => {
								console.log(error);
							});

							getDownloadURL(ref(storage, "deck-pic/"+`${user.uid}`+`/card/${array}/card-img`))
							.then((url) => {
								// `url` is the download URL for 'images/stars.jpg'

								// This can be downloaded directly:
								const xhr = new XMLHttpRequest();
								xhr.responseType = 'blob';
								xhr.onload = (event) => {
								const blob = xhr.response;
								};
								xhr.open('GET', url);
								xhr.send();

								// Or inserted into an <img> element
								const img = document.getElementById('img-carta');
								img.setAttribute('src', url);
							})
							.catch((error) => {
								// Handle any errors
							});

							getDownloadURL(ref(storage, "deck-pic/"+`${user.uid}`+`/card/${array}/back-img`))
							.then((url) => {
								// `url` is the download URL for 'images/stars.jpg'

								// This can be downloaded directly:
								const xhr = new XMLHttpRequest();
								xhr.responseType = 'blob';
								xhr.onload = (event) => {
								const blob = xhr.response;
								};
								xhr.open('GET', url);
								xhr.send();

								// Or inserted into an <img> element
								const img = document.getElementById('background-carta');
								img.setAttribute('src', url);
							})
							.catch((error) => {
								// Handle any errors
							});

							getDownloadURL(ref(storage, "deck-pic/"+`${user.uid}`+`/card/${array}/icon-img`))
							.then((url) => {
								// `url` is the download URL for 'images/stars.jpg'

								// This can be downloaded directly:
								const xhr = new XMLHttpRequest();
								xhr.responseType = 'blob';
								xhr.onload = (event) => {
								const blob = xhr.response;
								};
								xhr.open('GET', url);
								xhr.send();

								// Or inserted into an <img> element
								const img = document.getElementById('icon-img');
								img.setAttribute('src', url);
							})
							.catch((error) => {
								// Handle any errors
							});
						
							if(docSnapuu.data().click == true){
								if(docSnapuu.data().click != false){
									updateDoc(card, {
										click: false
									})
								}
							}

							}
						
						})
					})
						}) 
					})
				})


				//https://stackoverflow.com/questions/23401641/uncaught-notfounderror-failed-to-execute-insertbefore-on-node-the-node-bef

				const li= doc(db, user.uid, "deck")

				const docS = getDoc(li)
					.then(docS => {

				const array= docS.data().deckName;
				array.forEach(array =>{

					const deckRef = doc(db, user.uid, "profile", "Deck", `${array}`);

				const docSssnapu = getDoc(deckRef)
					.then(docSssnapu => {	

						const numb = docSssnapu.data().deckNumb;
									
									console.log(array);
									console.log(numb);	

				function myFunction() {
				const newItem = document.createElement("option");
				const textnode = document.createTextNode(`${array}`);

				newItem.setAttribute("id", `${array}`);
				newItem.appendChild(textnode);

				const list = document.getElementById("bar");
				list.insertBefore(newItem, list.childNodes[0]);
				}
				
				window.onload = myFunction();
				})
				})
				})


				/*function mate(){
				const liu= doc(db, user.uid, "deck");

				const docSn = getDoc(liu)
					.then(docSn => {

				const array= docSn.data().deckName;
				array.forEach(array =>{

					const se= document.querySelector('#bar');

					if(array!=null){
				se.addEventListener("click", function(){
				var e= document.getElementById(`${array}`);
				console.log(e.value);
				if(e==`${array}`){
					document.getElementById('button-03').style.display='none';  
					document.getElementById('button').style.display='block';        
				}
		})
			}
				})
				})
				}
				
				window.onload = mate();*/

				//two pack

				 document.getElementById("button").addEventListener("click", function(){
					 //Text
				const bordImageUrl= document.getElementById("border-url-carta-input").value;
				const cardName= document.getElementById("nome-carta-input").value;
				const cardImageUrl= document.getElementById("imagem-url-carta-input").value;
				const backImageUrl= document.getElementById("background-url-carta-input").value;
				const iconImageUrl= document.getElementById("icon-url-carta-input").value;
				const mana= document.getElementById("custo-mana-carta-input").value;
				const abilityOne= document.getElementById("atributos-carta-input").value;
				const descriptionOne= document.getElementById("descricao-carta-input").value;
				const abilityTwo= document.getElementById("atributos-carta-input2").value;
				const descriptionTwo= document.getElementById("descricao-carta-input2").value;

					//File
				const bordimg = document.getElementById('selecao-arquivo-bord').files.item(0);
				const cardimg = document.getElementById('selecao-arquivo-img').files.item(0);
				const backimg = document.getElementById('selecao-arquivo').files.item(0);
				const iconimg = document.getElementById('selecao-arquivo-icon').files.item(0);

					//Text
				/*console.log(bordImageUrl);
				console.log(cardName);
				console.log(cardImageUrl);
				console.log(backImageUrl);
				console.log(iconImageUrl);
				console.log(mana);
				console.log(abilityOne);
				console.log(descriptionOne);
				console.log(abilityTwo);
				console.log(descriptionTwo);

					//File
				console.log(bordimg);
				console.log(cardimg);
				console.log(backimg);
				console.log(iconimg);*/

				
				const db = getFirestore(firebaseApp);
				const deck = doc(db, user.uid, "deck");
				//const ref = db.collection(deck).doc;
				//const myId = deck.id;
				//console.log(myId);
				const list = doc(db, user.uid, "card");
					updateDoc(list, {
						Cards: arrayUnion(cardName)
					})
					/*updateDoc(list, {
						Cards: arrayRemove(cardName)
					})*/

				const docSnap = getDoc(deck)
					.then(docSnap => {
						if (docSnap.exists()) {
				const docSunap = getDoc(list)
					.then(docSunap => {

						
						var select= document.querySelector('#bar');
						var text = select.options[select.selectedIndex].text;
						console.log(text);
						console.log(docSnap.data().deckName);

						if (docSunap.exists()) {

							const querySnapshot =  getDocs(collection(db, text));
							console.log(querySnapshot);
							querySnapshot.then((docu) => {
							// doc.data() is never undefined for query doc snapshots

							//get the last item from list
							const array = docSunap.data().Cards.length;
							const ult = docSunap.data().Cards[array-1];
							console.log(array);
							console.log(ult);
							console.log(docu.query.id);
							
							const card = doc(db, user.uid, "deck", text, cardName);

							const docSnapu = getDoc(card)
							.then(docSnapu => {
								//numb = docSnapu.data().;

								console.log(card);			//1
							if(card.id != null){
								
								console.log(docu.query.id);

								if(docu.query.id == text){
									//numb ++;
								const card = doc(db, user.uid, "deck", text, cardName);
								console.log(card);
								
								if(docSunap.data().Cards[array] == " "){
									
								/*	updateDoc(card, {
									click: false,
									cardNumb: numb,
									bordImageUrl: bordImageUrl,
									cardName: cardName,
									cardImageUrl: cardImageUrl,
									backImageUrl: backImageUrl,
									iconImageUrl: iconImageUrl,
									mana: mana,
									abilityOne: abilityOne,
									descriptionOne: descriptionOne,
									abilityTwo: abilityTwo,
									descriptionTwo: descriptionTwo
									});*/
								}

									
								const num = docSunap.data().Cards;

								setDoc(card, {
								cardNumb: num.length,
								cardHTML: html,
								click: false,
								bordImageUrl: bordImageUrl,
								cardName: cardName,
								cardImageUrl: cardImageUrl,
								backImageUrl: backImageUrl,
								iconImageUrl: iconImageUrl,
								mana: mana,
								abilityOne: abilityOne,
								descriptionOne: descriptionOne,
								abilityTwo: abilityTwo,
								descriptionTwo: descriptionTwo
								});

								updateDoc(deck, {
									//quantidadeCartas: numb
								})
								
								domtoimage.toBlob(document.getElementById("carta"))
									.then(function(blob){
										const storage = getStorage(firebaseApp);
										const storageDeckImg = ref(storage, ("deck-pic/"+`${user.uid}`+`/card/${cardName}/deck-card-img`));
										uploadBytes(storageDeckImg, blob).then((snapshot) => {
											console.log('Uploaded a blob or file!');
										})
									});

								
							} else {
							// doc.data() will be undefined in this case
							console.log("No such document!");
							}
						}
						})
						});
					}
				})
						}
				})

			
				/*
								const storage = getStorage(firebaseApp);
								const storageBord = ref(storage, ("deck-pic/"+`${user.uid}`+`/card/${cardName}/bord-img`));
								const storageCard = ref(storage, ("deck-pic/"+`${user.uid}`+`/card/${cardName}/card-img`));
								const storageBack = ref(storage, ("deck-pic/"+`${user.uid}`+`/card/${cardName}/back-img`));
								const storageIcon = ref(storage, ("deck-pic/"+`${user.uid}`+`/card/${cardName}/icon-img`));
								

								console.log(storageBord);

								uploadBytes(storageBord, bordimg).then((snapshot) => {
								console.log('Uploaded a blob or file!');
								})

								uploadBytes(storageCard, cardimg).then((snapshot) => {
								console.log('Uploaded a blob or file!');
								})

								uploadBytes(storageBack, backimg).then((snapshot) => {
								console.log('Uploaded a blob or file!');
								})

								uploadBytes(storageIcon, iconimg).then((snapshot) => {
								console.log('Uploaded a blob or file!');
								})
			

				*/							
				})
				
			})
			


            
</script>

<footer><!--rodapé-->
	<p id="license">
		© 2021 Make Card Games. All Rights Reserved.
	</p>
</footer><!--fim do rodapé-->
</body>
</html>
